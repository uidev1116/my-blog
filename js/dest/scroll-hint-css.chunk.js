(window.acmsWebpackJsonp=window.acmsWebpackJsonp||[]).push([[32],{1271:function(t,e,n){},1294:function(t,e,n){n.r(e);n(87),n(27),n(74);var r=n(801),a=n.n(r),i=function(){function t(t,e,n){this.center=new Y.LatLng(0,0),this.marker=null,this.label=null,this.clusterOption=n,this.cluster=e,this.map=t,this.sums=0}return t.prototype.setSums=function(t){this.sums=t},t.prototype.hide=function(){this.marker&&this.map.removeFeature(this.marker),this.label&&this.map.removeFeature(this.label)},t.prototype.setCenter=function(t){this.center=t},t.prototype.getClusterSize=function(){for(var t=this.sums,e=1;t/10>=1;)t/=10,e++;return e},t.prototype.show=function(){this.marker&&this.map.removeFeature(this.marker),this.label&&this.map.removeFeature(this.label);var t=this.clusterOption.getClusterSize?this.clusterOption.getClusterSize(this.sums):this.getClusterSize(),e=new Y.Icon(""+this.clusterOption.imagePath+t+".png",{iconSize:new Y.Size(53,52),className:"ymap-cluster-icon"});this.marker=new Y.Marker(this.center,{icon:e}),this.map.addFeature(this.marker),this.label=new Y.Label(this.center,""+this.sums,{className:"ymap-cluster-label"}),this.map.addFeature(this.label),this.onAdd(this.marker)},t.prototype.onAdd=function(t){var e=this;this.marker&&this.marker.bind("click",(function(){var t=e.cluster.getCenter(),n=e.cluster.getBounds();if(n&&t){var r=e.map.getBoundsZoomLevel(n);e.map.setZoom(r,!0,t,!0)}})),this.label&&this.label.bind("click",(function(){var t=e.cluster.getCenter(),n=e.cluster.getBounds();if(n&&t){var r=e.map.getBoundsZoomLevel(n);e.map.setZoom(r,!0,t,!0)}}))},t}(),s={gridSize:60,minClusterSize:2,maxZoom:null,imagePath:"https://appleple.github.io/yahoo-map-cluster/images/cluster/"},o=function(){function t(t,e){this.markers=[],this.center=null,this.bounds=null;var n=Object.assign({},s,e);this.map=t,this.gridSize=n.gridSize,this.option=n,this.clusterIcon=new i(this.map,this,this.option)}return t.prototype.calculateBounds=function(){if(this.center){var t=new Y.LatLngBounds(this.center,this.center);this.bounds=this.getExtendedBounds(t)}},t.prototype.getExtendedBounds=function(t){var e=this.map.getZoom(),n=this.map.getProjection(),r=new Y.LatLng(t.getNorthEast().lat(),t.getNorthEast().lng()),a=new Y.LatLng(t.getSouthWest().lat(),t.getSouthWest().lng()),i=n.fromLatLngToPixel(r,e);i.x+=this.gridSize,i.y-=this.gridSize;var s=n.fromLatLngToPixel(a,e);s.x-=this.gridSize,s.y+=this.gridSize;var o=n.fromPixelToLatLng(i,e),l=n.fromPixelToLatLng(s,e);return t.extend(o),t.extend(l),t},t.prototype.getCenter=function(){return this.center},t.prototype.getBounds=function(){return this.bounds},t.prototype.addMarker=function(t){var e=this.option,n=this.map,r=e.minClusterSize;if(this.isMarkerAlreadyAdded(t))return!1;if(this.center){var a=this.markers.length+1,i=(this.center.lat()*(a-1)+t.getLatLng().lat())/a,s=(this.center.lng()*(a-1)+t.getLatLng().lng())/a;this.center=new Y.LatLng(i,s)}else this.center=t.getLatLng();this.calculateBounds(),this.markers.push(t);var o=this.markers.length;if(o<r&&n.addFeature(t),o===r)for(var l=0;l<o;l++)n.removeFeature(this.markers[l]);o>=r&&n.removeFeature(t),this.updateIcon()},t.prototype.isMarkerInClusterBounds=function(t){return!!this.bounds&&this.bounds.containsLatLng(t.getLatLng())},t.prototype.isMarkerAlreadyAdded=function(t){return!!this.markers.find((function(e){return e===t}))},t.prototype.getMaxZoom=function(){return this.option.maxZoom},t.prototype.hide=function(){this.clusterIcon.hide()},t.prototype.updateIcon=function(){var t=this,e=this.map.getZoom(),n=this.getMaxZoom();if(n&&e>n)this.markers.forEach((function(e){t.map.addFeature(e)}));else if(this.markers.length<this.option.minClusterSize)this.clusterIcon.hide();else{var r=this.markers.length;this.clusterIcon.setSums(r),this.center&&this.clusterIcon.setCenter(this.center),this.clusterIcon.show()}},t}(),l=function(){function t(t,e,n){void 0===n&&(n={});var r=this;this.clusters=[],this.markers=e,this.map=t,this.options=n,this.createClusters(),this.map.bind("zoomend",(function(){r.update()})),this.appendStyle()}return t.prototype.appendStyle=function(){var t=document.querySelector("body");if(t){!function(t,e){var n=document.createElement("div");for(n.innerHTML=e;n.children.length>0;)t.appendChild(n.children[0])}(t,'<style id="ymap-cluster"></style>');var e=document.querySelector("#ymap-cluster"),n=this.options.injectStyle?this.options.injectStyle():"",r=n||'\n      .ymap-cluster-label {\n        z-index: 2;\n        font-size: 14px;\n        width: 30px;\n        text-align: center;\n        position: absolute;\n        top: -13px;\n        left: -15px;\n        margin: 0 !important;\n        font-family: Hiragino Kaku Gothic Pro","ヒラギノ角ゴ Pro W3",Meiryo,"メイリオ","ＭＳ Ｐゴシック","MS PGothic",Verdana,sans-serif;\n      }\n      .ymap-cluster-icon {\n        margin-top: -28px !important;\n        z-index: 0 !important;\n      }\n      ';e&&(e.innerHTML=r)}},t.prototype.createClusters=function(){var t=this;this.markers.forEach((function(e){t.addToClosestCluster(e)}))},t.prototype.distanceBetweenPoints=function(t,e){var n=(e.lat()-t.lat())*Math.PI/180,r=(e.lng()-t.lng())*Math.PI/180,a=Math.sin(n/2)*Math.sin(n/2)+Math.cos(t.lat()*Math.PI/180)*Math.cos(e.lat()*Math.PI/180)*Math.sin(r/2)*Math.sin(r/2);return 6371*(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)))},t.prototype.getClosestCluster=function(t){var e=this,n=1/0,r=null;return this.clusters.forEach((function(a){var i=a.getCenter();if(i){var s=e.distanceBetweenPoints(i,t.getLatLng());s<n&&(n=s,r=a)}})),r},t.prototype.addToClosestCluster=function(t){this.clusters;var e=this.options,n=this.getClosestCluster(t);if(n&&n.isMarkerInClusterBounds(t))n.addMarker(t);else{var r=new o(this.map,e);r.addMarker(t),this.clusters.push(r)}},t.prototype.update=function(){var t=this;this.clusters.forEach((function(t){t.hide()})),this.clusters=[],this.markers.forEach((function(e){t.map.removeFeature(e)})),this.createClusters()},t.prototype.addMarker=function(t,e){e&&(this.markers.push(t),this.update())},t}();e.default=function(t){var e=parseFloat(t.dataset.lat),n=parseFloat(t.dataset.lng),r=parseFloat(t.dataset.zoom),i=t.dataset.cluster,s=t.dataset.markers||"",o=t.dataset.messages||"",u=s.split("|").map((function(t){return t.split(",").map((function(t){return parseFloat(t)}))})),h=o.split("[[:split:]]");a.a.exportGlobal=!0,a.a.appId=ACMS.Config.yahooApiKey,a.a.load((function(a){var s=new a.Map(t),o=new a.StyleMapLayer("railway"),p=new a.StyleMapLayer("monotone"),c=new a.StyleMapLayer("bold"),d=new a.StyleMapLayer("midnight"),m=new a.LayerSet("路線図",[o]);s.addLayerSet("MyRailwaySet",m);var f=new a.LayerSet("モノトーン",[p]);s.addLayerSet("MyMonotoneSet",f);var g=new a.LayerSet("ボールド",[c]);s.addLayerSet("MyBoldSet",g);var y=new a.LayerSet("ミッドナイト",[d]);s.addLayerSet("MyRMidnightSet",y),s.addControl(new a.SliderZoomControlVertical),s.addControl(new a.ScaleControl),"on"==ACMS.Config.yolpLayerSet&&s.addControl(new a.LayerSetControl),s.drawMap(new a.LatLng(e,n),r,a.LayerSetId.NORMAL);var L=u.map((function(t,e){var n=new a.Marker(new a.LatLng(t[0],t[1]));return h[e]&&n.bindInfoWindow(h[e]),n}));i?new l(s,L):L.forEach((function(t){s.addFeature(t)}))}))}},801:function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var r={endpoint:"https://map.yahooapis.jp/js/V1/jsapi",Y:null,appId:"",exportGlobal:!1,load:function(t){if(r.Y)t(r.Y);else{var e=document.createElement("script");e.src=r.endpoint+"?appId="+r.appId,e.onload=function(){r.Y=window.Y,r.Y&&t(r.Y),r.exportGlobal||(window.Y=null)},document.body.appendChild(e)}}};e.default=r}}]);